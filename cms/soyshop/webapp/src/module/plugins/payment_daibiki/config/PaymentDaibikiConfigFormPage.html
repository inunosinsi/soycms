<div class="alert alert-success" soy:display="updated">変更しました。</div>
<div class="alert alert-danger" soy:display="error">保存に失敗しました。</div>

<form method="post" soy:id="config_form">

	<div class="table-responsive">
		<table id="price_table" class="table table-striped" style="width:480px;margin: 0px;">
			<caption>代引き手数料の設定</caption>
			<thead>
				<tr>
					<th>商品代金（支払金額）</th>
					<th>手数料</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<td colspan="3" >
						<a class="btn btn-default" href="javascript:void(0);" id="add_fee_item" onclick="add_price();" tabindex="99">入力欄の追加</a>
					</td>
				</tr>
			</tfoot>
			<tbody>
				<!-- soy:id="price_list" -->
				<tr>
					<td nowrap>
						<input type="number" class="price_key alR" name="payment_daibiki[price_table][key][]" soy:id="item_price" /> 円以上
					</td>
					<td nowrap>
						<input type="number" class="text-right" name="payment_daibiki[price_table][price][]" soy:id="daibiki_fee" /> 円
					</td>
					<td nowrap>
						<a class="btn btn-danger btn-sm" soy:id="delete_button">削除</a>
					</td>
				</tr>
				<!-- /soy:id="price_list" -->
				<tr style="display:none;">
					<td>
						<input type="number" class="price_key alR" name="payment_daibiki[price_table][key][]" value="" disabled="disabled" tabindex="0" /> 円以上
					</td>
					<td>
						<input type="number" class="text-right" name="payment_daibiki[price_table][price][]" value="" disabled="disabled" tabindex="100" /> 円
					</td>
					<td>
						<a class="btn btn-danger btn-sm" href="javascript:void(0);" onclick="delete_price(this);">削除</a>
					</td>
				</tr>
			</tbody>

		</table>
	</div>

	<h4>地域毎の代引き手数料設定</h4>
	<div>
		代引き手数料が異なる地域を追加する。<select soy:id="area"><option></option></select>&nbsp;<input type="submit" class="btn btn-primary btn-sm" name="add" value="追加">
	</div>

	<div class="table-respponsive" soy:display="by_region">
		<!-- soy:id="region_list" -->
		<table soy:id="table_id" class="table table-striped" style="width:550px;margin: 10px 0 0 0 ;">
			<caption><!-- soy:id="area_name" /-->の代引き手数料の設定&nbsp;<input type="submit" class="btn btn-danger btn-sm" value="削除" soy:id="remove_button" onclick="return confirm('削除しますか？');"></caption>
			<thead>
				<tr>
					<th>商品代金（支払金額）</th>
					<th>手数料</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<td colspan="3" >
						<a class="btn btn-primary btn-sm" href="javascript:void(0);" soy:id="add_price_by_region" tabindex="99">入力欄の追加</a>
					</td>
				</tr>
			</tfoot>
			<tbody>
				<!-- soy:id="price_by_region_list" -->
				<tr>
					<td>
						<input class="price_key alR" soy:id="item_price" /> 円以上
					</td>
					<td>
						<input class="text-right" soy:id="daibiki_fee" /> 円
					</td>
					<td>
						<a class="btn btn-danger btn-sm" href="javascript:void(0);" onclick="$(this).parent().parent().remove();">削除</a>
					</td>
				</tr>
				<!-- /soy:id="price_by_region_list" -->
				<tr style="display:none;">
					<td>
						<input class="price_key alR" soy:id="default_item_price" value="" disabled="disabled" tabindex="0" /> 円以上
					</td>
					<td>
						<input class="text-right" soy:id="default_daibiki_fee" value="" disabled="disabled" tabindex="100" /> 円
					</td>
					<td>
						<a class="btn btn-danger btn-sm" soy:id="delete_price_by_region">削除</a>
					</td>
				</tr>
			</tbody>
		</table>
		<!-- /soy:id="region_list" -->
	</div>


	<div class="table-responsive">
		<table id="forbidden_items_table" class="table table-striped" style="width:480px;margin: 0px;">
			<caption>代引き不可商品の設定</caption>
			<thead>
				<tr>
					<th>商品コード</th>
					<th>商品名</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<td colspan="3" >
						<a class="btn btn-primary btn-sm" href="javascript:void(0);" onclick="add_item();" tabindex="299">入力欄の追加</a>
					</td>
				</tr>
			</tfoot>
			<tbody>
				<!-- soy:id="item_list" -->
				<tr>
					<td>
						<input class="form-control" name="payment_daibiki[item_table][]" value="" soy:id="item_code" />
					</td>
					<td>
						<a href="" soy:id="item_name">商品名です</a>
					</td>
					<td>
						<a class="btn btn-danger btn-sm" href="javascript:void(0);" onclick="$(this).parent().parent().remove();">削除</a>
					</td>
				</tr>
				<!-- /soy:id="item_list" -->
				<tr style="display:none;">
					<td>
						<input class="form-control" name="payment_daibiki[item_table][]" value="" disabled="disabled" tabindex="200" />
					</td>
					<td>&nbsp;</td>
					<td>
						<a class="btn btn-danger btn-sm" href="javascript:void(0);" onclick="delete_item(this);">削除</a>
					</td>
				</tr>
			</tbody>

		</table>
	</div>

	<!-- soy:ignore="cart" -->
	<h4>カートの代引き計算設定</h4>
	<input type="checkbox" soy:id="include_delivery_price">
	<!-- /soy:ignore="cart" -->

	<h4>注文の編集の設定</h4>
	<input type="checkbox" soy:id="order_auto_calc">


	<h4>文言設定</h4>
	<div class="form-group">
		<label>支払い方法選択時の文言<span class="option">HTML可。改行は反映されます。#PRICE#が計算後の代引き手数料に置換されます。</span></label>
		<textarea class="minieditor form-control" tabindex="300" soy:id="description"></textarea>
	</div>

	<div class="form-group">
		<label>メールの文章</label>
		<textarea class="minieditor form-control" tabindex="300" soy:id="mail"></textarea>
	</div>

	<div class="text-center">
		<input type="submit" name="Change" class="btn btn-primary btn-lg" value="変更" tabindex="400">
	</div>

</form>

<script type="text/javascript">
	var _add = function(table_id) {
		var tbody = $("#" + table_id + " tbody");
		var origin = $("#" + table_id + " tbody tr:last");
		var append = $("<tr>" + (origin.html()) + "</tr>").insertBefore(origin);
		$("td input", append).each(function(i) {
			$(this).removeAttr("disabled");
			var tabindex = $("tr", tbody).length + 1;
			if (i == 0) $(this).attr("tabindex", $(this).attr("tabindex") * 1 + tabindex);
			if (i == 1) $(this).attr("tabindex", $(this).attr("tabindex") * 1 + tabindex);
		});

		if ($("#price_table tbody tr").length == 3) {
			$("#price_table tbody tr a").each(function() {
				$(this).css("visibility", "");
			});
		}
	}
	var add_price = function() {
		_add("price_table");
	}
	var add_price_by_region = function(area){
		_add("price_table_by_region_" + area);
	}

	var add_item = function() {
		_add("forbidden_items_table")
	}

	var _delete = function(ele, table_id) {
		if ($("#" + table_id + " tbody tr").length > 2) {
			$(ele).parent().parent().remove();
		}
		if ($("#price_table tbody tr").length == 2) {
			$("#price_table tbody tr a").css("visibility", "hidden");
		}
	}
	var delete_price = function(ele) {
		_delete(ele, "price_table");
	}
	var delete_price_by_region = function(ele, area) {
		_delete(ele, "price_table_by_region_" + area);
	}
	var delete_item = function(ele) {
		_delete(ele, "forbidden_items_table");
	}
</script>
